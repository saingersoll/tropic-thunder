---
title: "diatom-vis"
author: soapy soap
format: html
editor: visual
---

## Libraries

```{r}
library(here)
library(tidyverse)
library(janitor)
library(dplyr)
library(lubridate)
```

## Read in Data

```{r}
# read in diatom data
Q3_diatom_raw <- read_csv(here("diatom-raw-data", "Mameyesdiatomdata.csv")) %>% 
  janitor::clean_names()

# read in chemistry data to compare
Q3_ph <-  read_csv(here("raw-data", "QuebradaCuenca3-Bisley.csv")) %>% 
  janitor::clean_names()
```

## Clean Data

```{r}
# clean Q3 data
Q3_ph_clean <- Q3_ph %>% clean_names() %>% 
  mutate(clean_date = lubridate::ymd(sample_date)) %>% 
  select(clean_date, p_h, sample_id)

# filter diatom data to only Q3 site
Q3_d_clean <- Q3_diatom_raw %>% 
  filter(site == "BQ3")
```

## Combining Data

```{r}
## convert date to ISO format
convert_to_ISO <- function(date_string) {
  parsed_date <- mdy(date_string)
  iso_date <- as_date(parsed_date)
  return(iso_date)
}

## convert date format in data table
Q3_d_clean <- Q3_d_clean %>% 
  mutate(clean_date = convert_to_ISO(date))
```

```{r}
## join data into single table with cross_join by date
Q3_ph_d_join <- cross_join(Q3_ph_clean, Q3_d_clean)
```

### pH vs Percent alive

```{r}
## aggregated data table
agg_data <- Q3_ph_d_join %>%
  group_by(p_h, percent_live) %>%
  summarize(count = n(), .groups = "drop")
```

```{r}
## visualize pH versus percent of living diatoms 
ggplot(agg_data, aes(x=p_h,y=percent_live)) +
  geom_point(alpha=1/10) +
  xlim(5,9) 
```

## Selecting columns

```{r}
# Creating column vector to call
Q3_cols <- c("p_h", "side", "percent_live", "clean_date")

# Slicing df
# ATTENTION THIS DATA FRAME CONTAINS DOUBLES AND CHR 
# NEEDS TO BE CONVERTED TO NUMERIC TO PLOT
Q3_plot_df <- Q3_ph_d_join %>% 
  select(p_h, side, percent_live, clean_date) %>%
 
  
  # mutate(across(is.double(), as.numeric(), na.rm = TRUE)) %>% 
  #mutate(across(is.character(), as.numeric(), na.rm = TRUE))

#mutate(across(p_h:clean_date, as.numeric(), na.rm = TRUE))

 # mutate(across(Q3_cols, is.numeric)
  
# %>%  filter(!is.na(percent_live))

View(Q3_plot_df)
```

## Data Viz

```{r}
Q3_ph_plot <- ggplot(data = Q3_plot_df, aes(x = clean_date, y = p_h)) +
  geom_jitter(aes(color = side))
```
